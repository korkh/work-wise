import{c as C,l as _,T as S,u as j,s as v,B as E,a as L,b as N,r as d,d as b,e as A,f as R,g,h as T,i as P,j as r,C as U,k as B,m as I,I as f,n as O}from"./index-CIASI9xv.js";import{D as M}from"./DynamicReducerLoader-D_TUlq9C.js";const D=n=>{var s;return((s=n==null?void 0:n.signInForm)==null?void 0:s.email)||""},J=n=>{var s;return(s=n==null?void 0:n.signInForm)==null?void 0:s.error},K=n=>{var s;return((s=n==null?void 0:n.signInForm)==null?void 0:s.isLoading)||!1},q=n=>{var s;return((s=n==null?void 0:n.signInForm)==null?void 0:s.password)||""},G="_signInForm_1r1vg_1",H="_input_1r1vg_13",V="_signInBtn_1r1vg_18",W="_forMobile_1r1vg_23",m={signInForm:G,input:H,signInBtn:V,forMobile:W},u=C("signIn/signInUser",async(n,s)=>{const{dispatch:o,rejectWithValue:a}=s;try{const e=await o(_(n)).unwrap();return e&&e.token&&(localStorage.setItem(S,JSON.stringify(e.token)),o(j.setAuthData(e)),v(o,e.token)),e}catch(e){return console.error("Failed to sign in",e),E.error("Failed to sign in"),a("Failed to sign in")}}),Y={isLoading:!1,email:"",password:"",user:null},$=L({name:"signIn",initialState:Y,reducers:{setEmail:(n,s)=>{n.email=s.payload},setPassword:(n,s)=>{n.password=s.payload}},extraReducers:n=>{n.addCase(u.pending,s=>{s.error=void 0,s.isLoading=!0}).addCase(u.fulfilled,(s,{payload:o})=>{s.isLoading=!1;const[a,e]=N(atob(o.token.split(".")[1]));if(a){console.error("Failed to parse claims from token",a);return}const i=e.role||e["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"],t=e.email||e["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress"],c=e.nameid||e["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier"];s.user={...o,id:c,email:t,roles:typeof i=="string"?[i]:i},localStorage.setItem(S,JSON.stringify(s.user.token))}).addCase(u.rejected,(s,o)=>{s.isLoading=!1,s.error=o.payload})}}),{reducer:z,actions:h}=$,Q={signInForm:z},ss=d.memo(function({className:s,onSuccess:o}){const{t:a}=b("translation"),e=A(),i=R(),t=g(D),c=g(q),w=g(K),x=g(J),p=T(),F=d.useCallback(l=>{e(h.setEmail(l))},[e]),k=d.useCallback(l=>{e(h.setPassword(l))},[e]),y=d.useCallback(async()=>{(await e(u({email:t,password:c}))).meta.requestStatus==="fulfilled"&&(o(),p(),i(P()))},[e,t,c,o,p,i]);return r.jsx(M,{removeAfterUnmount:!0,reducers:Q,children:r.jsxs(U,{gap:"16",className:B(m.signInForm,[s],{}),children:[r.jsx(I,{title:`${a("Please sign in here")}!`}),x&&r.jsx(I,{text:a("Incorrect login email or password"),variant:"error"}),r.jsx(f,{autofocus:!0,type:"email",className:m.input,placeholder:a("Email"),onChange:F,value:t}),r.jsx(f,{type:"password",className:m.input,placeholder:a("Password"),onChange:k,value:c}),r.jsx(O,{className:m.signInBtn,onClick:y,disabled:w,children:a("Sign in")})]})})});export{ss as default};
