import{c as j,l as E,T as w,u as L,s as N,B as A,a as M,b as R,r as m,d as T,e as v,f as P,g,h as U,i as B,j as O,k as a,C as D,m as f,n as h,I as y,o as J}from"./index-Emr_5gFi.js";import{D as K}from"./DynamicReducerLoader-DW5heBXK.js";const q=n=>{var s;return((s=n==null?void 0:n.signInForm)==null?void 0:s.email)||""},G=n=>{var s;return(s=n==null?void 0:n.signInForm)==null?void 0:s.error},H=n=>{var s;return((s=n==null?void 0:n.signInForm)==null?void 0:s.isLoading)||!1},V=n=>{var s;return((s=n==null?void 0:n.signInForm)==null?void 0:s.password)||""},W="_signInForm_ipuyl_1",Y="_input_ipuyl_8",$="_signInBtn_ipuyl_13",z="_forMobile_ipuyl_18",c={signInForm:W,input:Y,signInBtn:$,forMobile:z},u=j("signIn/signInUser",async(n,s)=>{const{dispatch:o,rejectWithValue:i}=s;try{const e=await o(E(n)).unwrap();return e&&e.token&&(localStorage.setItem(w,JSON.stringify(e.token)),o(L.setAuthData(e)),N(o,e.token)),e}catch(e){return console.error("Failed to sign in",e),A.error("Failed to sign in"),i("Failed to sign in")}}),Q={isLoading:!1,email:"",password:"",user:null},X=M({name:"signIn",initialState:Q,reducers:{setEmail:(n,s)=>{n.email=s.payload},setPassword:(n,s)=>{n.password=s.payload}},extraReducers:n=>{n.addCase(u.pending,s=>{s.error=void 0,s.isLoading=!0}).addCase(u.fulfilled,(s,{payload:o})=>{s.isLoading=!1;const[i,e]=R(atob(o.token.split(".")[1]));if(i){console.error("Failed to parse claims from token",i);return}const r=e.role||e["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"],t=e.email||e["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress"],l=e.nameid||e["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier"];s.user={...o,id:l,email:t,roles:typeof r=="string"?[r]:r},localStorage.setItem(w,JSON.stringify(s.user.token))}).addCase(u.rejected,(s,o)=>{s.isLoading=!1,s.error=o.payload})}}),{reducer:Z,actions:S}=X,ss={signInForm:Z},os=m.memo(function({className:s,onSuccess:o}){const{t:i}=T("translation"),e=v(),r=P(),t=g(q),l=g(V),x=g(H),F=U(),k=g(G),p=B(),C=m.useCallback(d=>{e(S.setEmail(d))},[e]),_=m.useCallback(d=>{e(S.setPassword(d))},[e]),b=m.useCallback(async()=>{(await e(u({email:t,password:l}))).meta.requestStatus==="fulfilled"&&(o(),p(),r(O()))},[e,t,l,o,p,r]),I={[c.forMobile]:F};return a.jsx(K,{removeAfterUnmount:!0,reducers:ss,children:a.jsxs(D,{gap:"16",className:f(c.signInForm,[s],I),children:[a.jsx(h,{title:`${i("Please sign in here")}!`}),k&&a.jsx(h,{text:i("Incorrect login email or password"),variant:"error"}),a.jsx(y,{autofocus:!0,type:"email",className:c.input,placeholder:i("Email"),onChange:C,value:t}),a.jsx(y,{type:"password",className:c.input,placeholder:i("Password"),onChange:_,value:l}),a.jsx(J,{className:f(c.signInBtn,[],I),onClick:b,disabled:x,children:i("Sign in")})]})})});export{os as default};
