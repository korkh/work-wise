import{c as C,l as j,T as S,u as E,s as L,B as _,a as N,b as A,r as d,d as R,e as T,f as v,g as m,h as P,i as U,j as i,C as b,k as B,m as I,I as f,n as O}from"./index-kcKrL_YS.js";import{D}from"./DynamicReducerLoader-C5o9nBj-.js";const z=n=>{var s;return((s=n==null?void 0:n.signInForm)==null?void 0:s.email)||""},J=n=>{var s;return(s=n==null?void 0:n.signInForm)==null?void 0:s.error},K=n=>{var s;return((s=n==null?void 0:n.signInForm)==null?void 0:s.isLoading)||!1},M=n=>{var s;return((s=n==null?void 0:n.signInForm)==null?void 0:s.password)||""},q="_signInForm_1s10z_1",G="_input_1s10z_7",H="_signInBtn_1s10z_11",g={signInForm:q,input:G,signInBtn:H},u=C("signIn/signInUser",async(n,s)=>{const{dispatch:a,rejectWithValue:o}=s;try{const e=await a(j(n)).unwrap();return e&&e.token&&(localStorage.setItem(S,JSON.stringify(e.token)),a(E.setAuthData(e)),L(a,e.token)),e}catch(e){return console.error("Failed to sign in",e),_.error("Failed to sign in"),o("Failed to sign in")}}),V={isLoading:!1,email:"",password:"",user:null},W=N({name:"signIn",initialState:V,reducers:{setEmail:(n,s)=>{n.email=s.payload},setPassword:(n,s)=>{n.password=s.payload}},extraReducers:n=>{n.addCase(u.pending,s=>{s.error=void 0,s.isLoading=!0}).addCase(u.fulfilled,(s,{payload:a})=>{s.isLoading=!1;const[o,e]=A(atob(a.token.split(".")[1]));if(o){console.error("Failed to parse claims from token",o);return}const r=e.role||e["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"],t=e.email||e["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress"],c=e.nameid||e["http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier"];s.user={...a,id:c,email:t,roles:typeof r=="string"?[r]:r},localStorage.setItem(S,JSON.stringify(s.user.token))}).addCase(u.rejected,(s,a)=>{s.isLoading=!1,s.error=a.payload})}}),{reducer:Y,actions:h}=W,Q={signInForm:Y},$=d.memo(function({className:s,onSuccess:a}){const{t:o}=R(),e=T(),r=v(),t=m(z),c=m(M),w=m(K),x=m(J),p=P(),F=d.useCallback(l=>{e(h.setEmail(l))},[e]),k=d.useCallback(l=>{e(h.setPassword(l))},[e]),y=d.useCallback(async()=>{(await e(u({email:t,password:c}))).meta.requestStatus==="fulfilled"&&(a(),p(),r(U()))},[e,t,c,a,p,r]);return i.jsx(D,{removeAfterUnmount:!0,reducers:Q,children:i.jsxs(b,{gap:"16",className:B(g.signInForm,[s],{}),children:[i.jsx(I,{title:o("Please sign in here!")}),x&&i.jsx(I,{text:o("Incorrect login email or password"),variant:"error"}),i.jsx(f,{autofocus:!0,type:"email",className:g.input,placeholder:o("Email"),onChange:F,value:t}),i.jsx(f,{type:"password",className:g.input,placeholder:o("Password"),onChange:k,value:c}),i.jsx(O,{className:g.signInBtn,onClick:y,disabled:w,children:o("Sign in")})]})})});export{$ as default};
