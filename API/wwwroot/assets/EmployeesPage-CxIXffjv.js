import{c as E,T as L,A,a as _,r as m,d as x,g as u,k as g,n as N,e as j,p as z,q as I}from"./index-BoiowPVt.js";import{D as T}from"./DynamicReducerLoader-BfsGIc1D.js";import{E as P}from"./employee_consts-Dz_c2cdH.js";import{a as O}from"./EmployeeList-BY09Aznu.js";import{a as b}from"./addQueryParams-BwJGGhqi.js";import"./DateInput-BexSBjVQ.js";import"./react-datepicker-CdGXM7hC.js";const v="_employeesPage_djpsr_1",w="_list_djpsr_4",M={employeesPage:v,list:w},R=s=>{var e;return((e=s.employeePage)==null?void 0:e.isLoading)||!1},k=s=>{var e;return(e=s.employeePage)==null?void 0:e.error},C=s=>{var e;return((e=s.employeePage)==null?void 0:e.pageNumber)||1},F=s=>{var e;return((e=s.employeePage)==null?void 0:e.pageSize)||10},U=s=>{var e;return(e=s.employeePage)==null?void 0:e._inited},D=s=>{var e;return((e=s.employeePage)==null?void 0:e.order)??"asc"},q=s=>{var e;return((e=s.employeePage)==null?void 0:e.sort)??P.LASTNAME},K=s=>{var e;return((e=s.employeePage)==null?void 0:e.search)??""},d=E("employeesPage/fetchEmployeesList",async(s,e)=>{const{extra:t,rejectWithValue:o,getState:a}=e,r=localStorage.getItem(L),n=F(a()),i=q(a()),c=D(a()),h=C(a()),f=K(a());try{if(!r)throw new Error("No token found");b({sort:i,order:c,search:f});const y=await t.api.get("/employees",{headers:{Authorization:`Bearer ${r}`},params:{_expand:"user",_pageNumber:h,_pageSize:n,_sort:i,_order:c,q:f}});if(!y.data)throw new Error;return y.data}catch{return o("No response from server")}}),B={selectId:s=>s.id},l=A(B),{selectAll:G}=l.getSelectors(s=>s.employeePage||S),S={...l.getInitialState(),isLoading:!1,error:void 0,ids:[],entities:{},pageNumber:1,pageSize:8,hasMore:!0,order:"asc",sort:P.LASTNAME,search:"",_inited:!1},H=_({name:"pages/employeesPageSlice",initialState:S,reducers:{setPage:(s,e)=>{s.pageNumber=e.payload},setOrder:(s,e)=>{s.order=e.payload},setSort:(s,e)=>{s.sort=e.payload},setSearch:(s,e)=>{s.search=e.payload},initState:s=>{s.pageSize=10,s._inited=!0}},extraReducers:s=>{s.addCase(d.pending,(e,t)=>{e.error=void 0,e.isLoading=!0,t.meta.arg.replace&&l.removeAll(e)}).addCase(d.fulfilled,(e,t)=>{e.isLoading=!1,e.hasMore=t.payload.length>=e.pageSize;const o=t.payload.filter(a=>a.id);t.meta.arg.replace?l.setAll(e,o):l.addMany(e,o)}).addCase(d.rejected,(e,t)=>{e.isLoading=!1,e.error=t.payload})}}),{reducer:Q,actions:p}=H,V=E("employeesPage/initEmployeesPage",async(s,e)=>{const{getState:t,dispatch:o}=e;if(!U(t())){const r=s.get("order"),n=s.get("sort"),i=s.get("search");r&&o(p.setOrder(r)),n&&o(p.setSort(n)),i&&o(p.setSearch(i)),o(p.initState()),o(d({}))}}),W=m.memo(function(e){const{className:t}=e,{t:o}=x(),a=u(G),r=u(R),n=u(k),[i,c]=m.useState(!1);return m.useEffect(()=>{a&&c(!0)},[a]),n||!i?g.jsx(N,{text:o("Employees loading error")}):g.jsx(O,{"data-testid":"EmployeeList",employees:a,isLoading:r,className:t})}),Y={employeePage:Q},oe=m.memo(function(){const e=j(),[t]=z();return I(()=>{e(V(t))}),g.jsx(T,{reducers:Y,removeAfterUnmount:!1,children:g.jsx(W,{className:M.list})})});export{oe as default};
