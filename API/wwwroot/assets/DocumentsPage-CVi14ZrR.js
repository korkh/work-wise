import{c as y,T,A as N,a as I,r as u,d as D,k as r,L as R,m as A,n as E,G as w,D as M,E as j,F as x,g as f,H as O,e as W,p as k,q as b}from"./index-Emr_5gFi.js";import{a as z}from"./addQueryParams-BwJGGhqi.js";import{D as H}from"./DynamicReducerLoader-DW5heBXK.js";const v="_documentsPage_bhoj8_1",C={documentsPage:v};var P=(t=>(t.ID="id",t.EMPLOYEE="lastName",t.EMPLOYEE_ID="employeeId",t.TITLE="title",t.ISSUE_DATE="issueDate",t.EXPIRATION_DATE="expirationDate",t.HAS_TWO_MONTH_WARNING="hasTwoMonthWarning",t.HAS_THREE_MONTH_WARNING="hasThreeMonthWarning",t.HAS_SIX_MONTH_WARNING="hasSixMonthWarning",t))(P||{});const G=t=>{var e;return((e=t.documentPage)==null?void 0:e.isLoading)||!1},U=t=>{var e;return(e=t.documentPage)==null?void 0:e.error},B=t=>{var e;return((e=t.documentPage)==null?void 0:e.pageNumber)||1},K=t=>{var e;return((e=t.documentPage)==null?void 0:e.pageSize)||10},Y=t=>{var e;return(e=t.documentPage)==null?void 0:e._inited},$=t=>{var e;return((e=t.documentPage)==null?void 0:e.order)??"asc"},q=t=>{var e;return((e=t.documentPage)==null?void 0:e.sort)??P.TITLE},X=t=>{var e;return((e=t.documentPage)==null?void 0:e.search)??""},h=y("employeesPage/fetchDocumenstList",async(t,e)=>{const{extra:o,rejectWithValue:a,getState:s}=e,c=localStorage.getItem(T),d=K(s()),i=q(s()),n=$(s()),S=B(s()),_=X(s());try{if(!c)throw new Error("No token found");z({sort:i,order:n,search:_});const p=await o.api.get("/documents",{headers:{Authorization:`Bearer ${c}`},params:{_expand:"user",_pageNumber:S,_pageSize:d,_sort:i,_order:n,q:_}});if(!p.data)throw new Error;return p.data}catch{return a("No response from server")}}),Q={selectId:t=>t.id},m=N(Q),L={...m.getInitialState(),isLoading:!1,error:void 0,ids:[],entities:{},pageNumber:1,pageSize:10,hasMore:!0,order:"asc",sort:P.TITLE,search:"",_inited:!1},V=t=>t.documentPage||L,{selectAll:J,selectById:me}=m.getSelectors(V),Z=I({name:"pages/documentPageSlice",initialState:L,reducers:{setPage:(t,e)=>{t.pageNumber=e.payload},setOrder:(t,e)=>{t.order=e.payload},setSort:(t,e)=>{t.sort=e.payload},setSearch:(t,e)=>{t.search=e.payload},initState:t=>{t.pageSize=8,t._inited=!0}},extraReducers:t=>{t.addCase(h.pending,(e,o)=>{e.error=void 0,e.isLoading=!0,o.meta.arg.replace&&m.removeAll(e)}).addCase(h.fulfilled,(e,o)=>{e.isLoading=!1,e.hasMore=o.payload.length>=e.pageSize;const a=o.payload.filter(s=>s.employeeId);o.meta.arg.replace?m.setAll(e,a):m.addMany(e,a)}).addCase(h.rejected,(e,o)=>{e.isLoading=!1,e.error=o.payload})}}),{reducer:F,actions:g}=Z,ee=y("documents/initDocumentPage",async(t,e)=>{const{getState:o,dispatch:a}=e;if(!Y(o())){const c=t.get("order"),d=t.get("sort"),i=t.get("search");c&&a(g.setOrder(c)),d&&a(g.setSort(d)),i&&a(g.setSearch(i)),a(g.initState()),a(h({}))}}),te="_redRow_1s7kx_1",se="_orangeRow_1s7kx_5",ae="_yellowRow_1s7kx_9",l={redRow:te,orangeRow:se,yellowRow:ae},oe=u.memo(function(e){const{className:o,documents:a,isLoading:s}=e,{t:c}=D(),d=[{key:"id",header:"No."},{key:"employee",nestedKeys:["lastName"],header:"Lastname"},{key:"title",header:"Title"},{key:"issueDate",header:"Issued",render:n=>x(n)},{key:"expirationDate",header:"Expire",render:n=>x(n)}],i=n=>n.hasTwoMonthWarning&&n.hasThreeMonthWarning&&n.hasSixMonthWarning?l.redRow:n.hasThreeMonthWarning&&n.hasSixMonthWarning?l.orangeRow:n.hasSixMonthWarning?l.yellowRow:"";return s?r.jsx(R,{}):!s&&!a.length?r.jsx("div",{className:A(l.documentsList,[o],{}),children:r.jsx(E,{size:"l",title:c("Documents not found")})}):r.jsx(r.Fragment,{children:r.jsx(w,{title:"List of documents",columns:d,data:a,redirect:M,getRowClass:i,children:r.jsx(j,{data:a,isLoading:s,fileName:"Documents"})})})}),ne=u.memo(function(e){const{className:o}=e,{t:a}=D(),s=f(J),c=f(G),d=f(U),[i,n]=u.useState(!1);return u.useEffect(()=>{s&&s.length>0&&n(!0)},[s]),d?r.jsx(E,{text:a("Documents loading error")}):c||!i?r.jsx(O,{}):r.jsx(oe,{"data-testid":"EmployeeList",documents:s,isLoading:c,className:o})}),re={documentPage:F},ce=()=>{const t=W(),[e]=k();return b(()=>{t(ee(e))}),r.jsx(H,{reducers:re,removeAfterUnmount:!1,children:r.jsx(ne,{className:C.list})})},ge=u.memo(ce);export{ge as default};
